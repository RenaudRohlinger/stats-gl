class S{constructor({trackGPU:e=!1,trackCPT:i=!1,trackHz:r=!1,trackFPS:n=!0,logsPerSecond:s=4,graphsPerSecond:o=30,samplesLog:p=40,samplesGraph:g=10,precision:h=2}={}){this.gl=null,this.ext=null,this.gpuDevice=null,this.gpuBackend=null,this.renderer=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.webgpuNative=!1,this.gpuQuerySet=null,this.gpuResolveBuffer=null,this.gpuReadBuffers=[],this.gpuWriteBufferIndex=0,this.gpuFrameCount=0,this.pendingResolve=null,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.trackGPU=e,this.trackCPT=i,this.trackHz=r,this.trackFPS=n,this.samplesLog=p,this.samplesGraph=g,this.precision=h,this.logsPerSecond=s,this.graphsPerSecond=o;const f=performance.now();this.prevGraphTime=f,this.beginTime=f,this.prevTextTime=f,this.prevCpuTime=f}async init(e){if(!e){console.error('Stats: The "canvas" parameter is undefined.');return}if(!this.handleThreeRenderer(e)&&!await this.handleWebGPURenderer(e)&&!this.handleNativeWebGPU(e))if(this.initializeWebGL(e)){this.trackGPU&&this.initializeGPUTracking();return}else console.error("Stats-gl: Failed to initialize WebGL context")}handleNativeWebGPU(e){return e&&typeof e.createCommandEncoder=="function"&&typeof e.createQuerySet=="function"&&e.queue?(this.gpuDevice=e,this.webgpuNative=!0,this.trackGPU&&e.features?.has("timestamp-query")&&(this.initializeWebGPUTiming(),this.onWebGPUTimestampSupported()),!0):!1}initializeWebGPUTiming(){if(this.gpuDevice){this.gpuQuerySet=this.gpuDevice.createQuerySet({type:"timestamp",count:2}),this.gpuResolveBuffer=this.gpuDevice.createBuffer({size:16,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC});for(let e=0;e<2;e++)this.gpuReadBuffers.push(this.gpuDevice.createBuffer({size:16,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}))}}handleThreeRenderer(e){return e.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(e){return e.isWebGPURenderer?(this.renderer=e,(this.trackGPU||this.trackCPT)&&(e.backend.trackTimestamp=!0,e._initialized||await e.init(),e.hasFeature("timestamp-query")&&this.onWebGPUTimestampSupported()),this.info=e.info,this.gpuBackend=e.backend,this.gpuDevice=e.backend?.device||null,this.patchThreeWebGPU(e),!0):!1}onWebGPUTimestampSupported(){}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas){if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&this.onGPUTrackingInitialized())}onGPUTrackingInitialized(){}getTimestampWrites(){if(!(!this.webgpuNative||!this.gpuQuerySet))return{querySet:this.gpuQuerySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}begin(e){this.beginProfiling("cpu-started"),!this.webgpuNative&&(!this.gl||!this.ext||(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery)))}end(e){if(this.renderCount++,this.webgpuNative&&e&&this.gpuQuerySet&&this.gpuResolveBuffer&&this.gpuReadBuffers.length>0){this.gpuFrameCount++;const i=this.gpuReadBuffers[this.gpuWriteBufferIndex];i.mapState==="unmapped"&&(e.resolveQuerySet(this.gpuQuerySet,0,2,this.gpuResolveBuffer,0),e.copyBufferToBuffer(this.gpuResolveBuffer,0,i,0,16)),this.endProfiling("cpu-started","cpu-finished","cpu-duration");return}this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}async resolveTimestampsAsync(){if(!this.webgpuNative||this.gpuReadBuffers.length===0)return this.totalGpuDuration;if(this.pendingResolve)return this.pendingResolve;const e=(this.gpuWriteBufferIndex+1)%2,i=this.gpuReadBuffers[e];if(this.gpuWriteBufferIndex=(this.gpuWriteBufferIndex+1)%2,this.gpuFrameCount<2)return this.totalGpuDuration;if(i.mapState!=="unmapped")return this.totalGpuDuration;this.pendingResolve=this._resolveTimestamps(i);try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveTimestamps(e){try{await e.mapAsync(GPUMapMode.READ);const i=new BigInt64Array(e.getMappedRange()),r=i[0],n=i[1];e.unmap();const s=Number(n-r);return this.totalGpuDuration=s/1e6,this.totalGpuDuration}catch{return this.totalGpuDuration}}processGpuQueries(){if(!(!this.gl||!this.ext)){this.totalGpuDuration=0;for(let e=this.gpuQueries.length-1;e>=0;e--){const i=this.gpuQueries[e],r=this.gl.getQueryParameter(i.query,this.gl.QUERY_RESULT_AVAILABLE),n=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(r&&!n){const o=this.gl.getQueryParameter(i.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(i.query),this.gpuQueries.splice(e,1)}}}}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}beginProfiling(e){if(typeof performance<"u")try{performance.clearMarks(e),performance.mark(e)}catch(i){console.debug("Stats: Performance marking failed:",i)}}endProfiling(e,i,r){if(!(typeof performance>"u"||!i||!e))try{performance.getEntriesByName(e,"mark").length===0&&this.beginProfiling(e),performance.clearMarks(i),performance.mark(i),performance.clearMeasures(r);const s=performance.measure(r,e,i);this.totalCpuDuration+=s.duration,performance.clearMarks(e),performance.clearMarks(i),performance.clearMeasures(r)}catch(n){console.debug("Stats: Performance measurement failed:",n)}}calculateFps(){const e=performance.now();for(this.frameTimes.push(e);this.frameTimes.length>0&&this.frameTimes[0]<=e-1e3;)this.frameTimes.shift();return Math.round(this.frameTimes.length)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&this.totalGpuDurationCompute!==void 0&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(e,i){for(i.logs.push(e);i.logs.length>this.samplesLog;)i.logs.shift();for(i.graph.push(e);i.graph.length>this.samplesGraph;)i.graph.shift()}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=performance.now()}getData(){const e=this.averageFps.logs,i=this.averageCpu.logs,r=this.averageGpu.logs,n=this.averageGpuCompute.logs;return{fps:e.length>0?e[e.length-1]:0,cpu:i.length>0?i[i.length-1]:0,gpu:r.length>0?r[r.length-1]:0,gpuCompute:n.length>0?n[n.length-1]:0}}patchThreeWebGPU(e){const i=e.info.reset,r=this;e.info.reset=function(){r.beginProfiling("cpu-started"),i.call(this)}}patchThreeRenderer(e){const i=e.render,r=this;e.render=function(n,s){r.begin(),i.call(this,n,s),r.end()},this.threeRendererPatched=!0}dispose(){if(this.gl){if(this.activeQuery&&this.ext){try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT)}catch{}this.gl.deleteQuery(this.activeQuery),this.activeQuery=null}for(const e of this.gpuQueries)this.gl.deleteQuery(e.query);this.gpuQueries.length=0}this.gpuQuerySet&&(this.gpuQuerySet.destroy(),this.gpuQuerySet=null),this.gpuResolveBuffer&&(this.gpuResolveBuffer.destroy(),this.gpuResolveBuffer=null);for(const e of this.gpuReadBuffers)e.mapState==="mapped"&&e.unmap(),e.destroy();this.gpuReadBuffers.length=0,this.gpuFrameCount=0,this.pendingResolve=null,this.webgpuNative=!1,this.gl=null,this.ext=null,this.info=void 0,this.gpuDevice=null,this.gpuBackend=null,this.renderer=null,this.frameTimes.length=0,this.averageFps.logs.length=0,this.averageFps.graph.length=0,this.averageCpu.logs.length=0,this.averageCpu.graph.length=0,this.averageGpu.logs.length=0,this.averageGpu.graph.length=0,this.averageGpuCompute.logs.length=0,this.averageGpuCompute.graph.length=0}}const P=90,_=48;class W{constructor(e,i=P,r=_){this.previewFbo=null,this.previewTexture=null,this.gl=e,this.previewWidth=i,this.previewHeight=r,this.pixels=new Uint8Array(i*r*4),this.flippedPixels=new Uint8Array(i*r*4),this.initResources()}resize(e,i){e===this.previewWidth&&i===this.previewHeight||(this.previewWidth=e,this.previewHeight=i,this.pixels=new Uint8Array(e*i*4),this.flippedPixels=new Uint8Array(e*i*4),this.dispose(),this.initResources())}initResources(){const e=this.gl;this.previewTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.previewTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA8,this.previewWidth,this.previewHeight,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.previewFbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.previewFbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.previewTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindTexture(e.TEXTURE_2D,null)}async capture(e,i,r,n="default"){const s=this.gl,o=s.getParameter(s.READ_FRAMEBUFFER_BINDING),p=s.getParameter(s.DRAW_FRAMEBUFFER_BINDING);s.bindFramebuffer(s.READ_FRAMEBUFFER,e),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.previewFbo),s.blitFramebuffer(0,0,i,r,0,0,this.previewWidth,this.previewHeight,s.COLOR_BUFFER_BIT,s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,this.previewFbo),s.readPixels(0,0,this.previewWidth,this.previewHeight,s.RGBA,s.UNSIGNED_BYTE,this.pixels),s.bindFramebuffer(s.READ_FRAMEBUFFER,o),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,p);const g=this.flipY(this.pixels,this.previewWidth,this.previewHeight),h=new ImageData(new Uint8ClampedArray(g),this.previewWidth,this.previewHeight);return createImageBitmap(h)}flipY(e,i,r){const n=i*4;for(let s=0;s<r;s++){const o=s*n,p=(r-1-s)*n;this.flippedPixels.set(e.subarray(o,o+n),p)}return this.flippedPixels}removeSource(e){}dispose(){const e=this.gl;this.previewFbo&&(e.deleteFramebuffer(this.previewFbo),this.previewFbo=null),this.previewTexture&&(e.deleteTexture(this.previewTexture),this.previewTexture=null)}}class L{constructor(e,i=P,r=_){this.previewTexture=null,this.stagingBuffer=null,this.blitPipeline=null,this.sampler=null,this.bindGroupLayout=null,this.initialized=!1,this.device=e,this.previewWidth=i,this.previewHeight=r,this.pixelsBuffer=new Uint8ClampedArray(i*r*4)}resize(e,i){e===this.previewWidth&&i===this.previewHeight||(this.previewWidth=e,this.previewHeight=i,this.pixelsBuffer=new Uint8ClampedArray(e*i*4),this.previewTexture&&this.previewTexture.destroy(),this.stagingBuffer&&this.stagingBuffer.destroy(),this.previewTexture=null,this.stagingBuffer=null,this.initialized&&this.createSizeResources())}createSizeResources(){const e=this.device;this.previewTexture=e.createTexture({size:{width:this.previewWidth,height:this.previewHeight},format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const i=Math.ceil(this.previewWidth*4/256)*256;this.stagingBuffer=e.createBuffer({size:i*this.previewHeight,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}async initResources(){if(this.initialized)return;const e=this.device;this.createSizeResources(),this.sampler=e.createSampler({minFilter:"linear",magFilter:"linear"});const i=e.createShaderModule({code:`
        @group(0) @binding(0) var texSampler: sampler;
        @group(0) @binding(1) var texInput: texture_2d<f32>;

        struct VertexOutput {
          @builtin(position) position: vec4f,
          @location(0) uv: vec2f
        }

        @vertex
        fn vertexMain(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
          var positions = array<vec2f, 3>(
            vec2f(-1.0, -1.0),
            vec2f(3.0, -1.0),
            vec2f(-1.0, 3.0)
          );
          var uvs = array<vec2f, 3>(
            vec2f(0.0, 1.0),
            vec2f(2.0, 1.0),
            vec2f(0.0, -1.0)
          );

          var output: VertexOutput;
          output.position = vec4f(positions[vertexIndex], 0.0, 1.0);
          output.uv = uvs[vertexIndex];
          return output;
        }

        @fragment
        fn fragmentMain(@location(0) uv: vec2f) -> @location(0) vec4f {
          return textureSample(texInput, texSampler, uv);
        }
      `});this.bindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}]}),this.blitPipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[this.bindGroupLayout]}),vertex:{module:i,entryPoint:"vertexMain"},fragment:{module:i,entryPoint:"fragmentMain",targets:[{format:"rgba8unorm"}]},primitive:{topology:"triangle-list"}}),this.initialized=!0}async capture(e){if(await this.initResources(),!this.previewTexture||!this.stagingBuffer||!this.blitPipeline||!this.sampler||!this.bindGroupLayout)return null;const i=this.device,r=i.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:this.sampler},{binding:1,resource:e.createView()}]}),n=i.createCommandEncoder(),s=n.beginRenderPass({colorAttachments:[{view:this.previewTexture.createView(),loadOp:"clear",storeOp:"store",clearValue:{r:0,g:0,b:0,a:1}}]});s.setPipeline(this.blitPipeline),s.setBindGroup(0,r),s.draw(3),s.end();const o=Math.ceil(this.previewWidth*4/256)*256;n.copyTextureToBuffer({texture:this.previewTexture},{buffer:this.stagingBuffer,bytesPerRow:o},{width:this.previewWidth,height:this.previewHeight}),i.queue.submit([n.finish()]),await this.stagingBuffer.mapAsync(GPUMapMode.READ);const p=new Uint8Array(this.stagingBuffer.getMappedRange());for(let h=0;h<this.previewHeight;h++){const f=h*o,C=h*this.previewWidth*4;this.pixelsBuffer.set(p.subarray(f,f+this.previewWidth*4),C)}this.stagingBuffer.unmap();const g=new ImageData(new Uint8ClampedArray(this.pixelsBuffer),this.previewWidth,this.previewHeight);return createImageBitmap(g)}dispose(){this.previewTexture&&this.previewTexture.destroy(),this.stagingBuffer&&this.stagingBuffer.destroy(),this.previewTexture=null,this.stagingBuffer=null,this.blitPipeline=null,this.sampler=null,this.bindGroupLayout=null,this.initialized=!1}}function I(a,e){return a.isWebGLRenderTarget&&a.__webglFramebuffer?{framebuffer:a.__webglFramebuffer,width:a.width||1,height:a.height||1}:null}function M(a,e){return a.isRenderTarget&&a.texture&&e.get&&e.get(a.texture)?.texture||null}class N extends S{constructor(e={}){super(e),this.textureCaptureWebGL=null,this.textureCaptureWebGPU=null}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries();const e=this.calculateFps();this.addToAverage(e,this.averageFps),this.updateAverages(),this.resetCounters()}getData(){return super.getData()}async captureTexture(e,i="default"){if(this.gl){if(this.textureCaptureWebGL||(this.textureCaptureWebGL=new W(this.gl)),e.isWebGLRenderTarget){const r=I(e,this.gl);if(r)return this.textureCaptureWebGL.capture(r.framebuffer,r.width,r.height,i)}if(e.framebuffer&&e.width&&e.height)return this.textureCaptureWebGL.capture(e.framebuffer,e.width,e.height,i)}if(this.gpuDevice){if(this.textureCaptureWebGPU||(this.textureCaptureWebGPU=new L(this.gpuDevice)),e.isRenderTarget&&this.gpuBackend){const r=M(e,this.gpuBackend);if(r)return this.textureCaptureWebGPU.capture(r)}if(e&&typeof e.createView=="function")return this.textureCaptureWebGPU.capture(e)}return null}disposeTextureCapture(){this.textureCaptureWebGL&&(this.textureCaptureWebGL.dispose(),this.textureCaptureWebGL=null),this.textureCaptureWebGPU&&(this.textureCaptureWebGPU.dispose(),this.textureCaptureWebGPU=null)}dispose(){this.disposeTextureCapture(),super.dispose()}}let t=null,l=null,F=512,G=512,d=null,m=null,c=null,T=null;const u=512;let E=null,w=null,R=null,b=null,y=null,A=null,x=null,B=0;function U(a,e,i){const r=a.createShader(e);return a.shaderSource(r,i),a.compileShader(r),a.getShaderParameter(r,a.COMPILE_STATUS)?r:(console.error("Shader compile error:",a.getShaderInfoLog(r)),null)}function v(a,e,i){const r=U(a,a.VERTEX_SHADER,e),n=U(a,a.FRAGMENT_SHADER,i),s=a.createProgram();return a.attachShader(s,r),a.attachShader(s,n),a.linkProgram(s),a.getProgramParameter(s,a.LINK_STATUS)?s:(console.error("Program link error:",a.getProgramInfoLog(s)),null)}function Q(a){if(F=a.width,G=a.height,t=a.getContext("webgl2",{antialias:!1,alpha:!1}),!t){console.error("WebGL2 not supported");return}l=new N({trackGPU:!0}),l.init(t),c=t.createTexture(),t.bindTexture(t.TEXTURE_2D,c),t.texImage2D(t.TEXTURE_2D,0,t.RGBA8,u,u,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),d=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,d),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,c,0),T=t.createTexture(),t.bindTexture(t.TEXTURE_2D,T),t.texImage2D(t.TEXTURE_2D,0,t.RGBA8,u,u,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),m=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,m),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,T,0),t.bindFramebuffer(t.FRAMEBUFFER,null);const e=`#version 300 es
    in vec2 position;
    out vec2 vUv;
    void main() {
      vUv = position * 0.5 + 0.5;
      gl_Position = vec4(position, 0.0, 1.0);
    }
  `,i=`#version 300 es
    precision highp float;
    in vec2 vUv;
    out vec4 fragColor;
    uniform float time;

    void main() {
      float x = vUv.x * 10.0;
      float y = vUv.y * 10.0;
      float t = time * 2.0;

      float v1 = sin(x + t);
      float v2 = sin(y + t);
      float v3 = sin(x + y + t);
      float v4 = sin(sqrt(x*x + y*y) + t);

      float v = (v1 + v2 + v3 + v4) * 0.25;

      vec3 color = vec3(
        sin(v * 3.14159) * 0.5 + 0.5,
        sin(v * 3.14159 + 2.094) * 0.5 + 0.5,
        sin(v * 3.14159 + 4.188) * 0.5 + 0.5
      );

      fragColor = vec4(color, 1.0);
    }
  `,r=`#version 300 es
    precision highp float;
    in vec2 vUv;
    out vec4 fragColor;
    uniform sampler2D colorTex;

    void main() {
      vec3 color = texture(colorTex, vUv).rgb;
      float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));
      fragColor = vec4(vec3(luma), 1.0);
    }
  `,n=`#version 300 es
    precision highp float;
    in vec2 vUv;
    out vec4 fragColor;
    uniform sampler2D tex;

    void main() {
      fragColor = texture(tex, vUv);
    }
  `;R=v(t,e,i),b=v(t,e,r),E=v(t,e,n),y=t.getUniformLocation(R,"time"),A=t.getUniformLocation(b,"colorTex"),w=t.getUniformLocation(E,"tex"),x=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,x),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),t.STATIC_DRAW),B=performance.now(),requestAnimationFrame(D)}async function D(){const a=(performance.now()-B)*.001;l.begin(),t.bindBuffer(t.ARRAY_BUFFER,x),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.bindFramebuffer(t.FRAMEBUFFER,d),t.viewport(0,0,u,u),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(R),t.uniform1f(y,a),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.bindFramebuffer(t.FRAMEBUFFER,m),t.viewport(0,0,u,u),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(b),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c),t.uniform1i(A,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,F,G),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(E),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,c),t.uniform1i(w,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),l.end(),l.update();const e=await l.captureTexture({framebuffer:d,width:u,height:u}),i=await l.captureTexture({framebuffer:m,width:u,height:u}),r=l.getData();self.postMessage({type:"stats",data:r}),e&&self.postMessage({type:"texture",name:"Color",bitmap:e,width:u,height:u},[e]),i&&self.postMessage({type:"texture",name:"Luma",bitmap:i,width:u,height:u},[i]),requestAnimationFrame(D)}self.onmessage=a=>{a.data.type==="init"?Q(a.data.canvas):a.data.type==="stress"&&a.data.enabled};
